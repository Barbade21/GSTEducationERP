@model GSTEducationERPLibrary.Counsellor.Counsellor

@{
    ViewBag.Title = "AllStudentList";
    Layout = "~/Views/Shared/_LayoutERP.cshtml";
	@Html.Partial("_LoadingOverlay")
}
}

<head>
    <link href="~/Content/plugins/bootstrap-switch/css/bootstrap3/bootstrap-switch.min.css" rel="stylesheet" />
    <script src="~/Content/plugins/jquery/jquery.min.js" type="text/javascript"></script>
    <script src="~/Content/plugins/bootstrap/js/bootstrap.bundle.min.js" type="text/javascript"></script>
    <script src="~/Content/plugins/bootstrap-switch/js/bootstrap-switch.min.js"></script>
    <link rel="stylesheet" href="~/Content/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="~/Content/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="~/Content/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <link rel="stylesheet" href="~/Content/plugins/toastr/toastr.min.css" />
	<script src="~/Content/Admin/js/overlay.js"></script>
    <style>

        .dataTables_wrapper .btn-secondary {
            color: #235;
            background-color: transparent !important;
            border-color: transparent;
            font-size: x-large;
            margin: 0px !important;
            /* border: 2px solid black;*/
        }

        h2 {
            padding-top: 10px;
            margin-bottom: 10px;
            font-family: Verdana;
            font-weight: bold;
            font-size: medium;
            color: #33CCCC;
        }

        .card-primary.card-outline-tabs > .card-header a.active {
            border-top: 3px solid #33CCCC;
        }

        a {
            color: #33CCCC;
        }

        .card.card-outline-tabs .card-header a:hover {
            color: #33CCCC;
        }

        .card-primary.card-outline-tabs > .card-header a.active, .card-primary.card-outline-tabs > .card-header a.active:hover {
            border-top: 3px solid #33CCCC;
        }

        .card-body {
         
            padding-bottom: 0px !important;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        th {
            background-color: #33CCCC;
            color: #000;
            text-align: center !important;
        }

        td {
            text-align: center;
            color: black !important;
            border: 2px black;
        }

        .table td {
            padding: 0px 0px 0px 0px !important;
            font-size: 14px !important;
        }

        .table th {
            padding: 5px 5px 4px 10px !important;
            font-size: 14px !important;
        }

        table.dataTable > thead .sorting:after, table.dataTable > thead .sorting:before {
            font-size: xx-small !important;
        }

        div.dataTables_wrapper div.dataTables_filter {
            margin-top: -10px !important;
        }

        div.dt-buttons {
            margin-top: -20px !important;
        }

        .btn-group > .btn:not(:last-child):not(.dropdown-toggle), .btn-group > .btn-group:not(:last-child) > .btn {
            padding-left: 5px !important;
            padding-right: 5px !important;
        }

        div.dataTables_wrapper div.dataTables_filter label {
            font-size: small !important;
        }

        div.dataTables_wrapper div.dataTables_filter input {
            height: 20px !important;
        }

        div.dataTables_wrapper div.dataTables_info {
            padding: 0px !important;
            font-size: small !important;
        }

        div.dataTables_wrapper div.dataTables_paginate ul.pagination {
            margin-top: 0px !important;
        }

        div.dataTables_wrapper div.dataTables_paginate {
            font-size: small !important;
        }
    </style>


</head>

    <div class="card-body" style="padding-top:10px">

        <div class="container">

            <div class="col-md-12">
                <div class="card card-primary card-outline card-outline-tabs" style="width:81vw;left:-4vw;">
                    <div class="row">
                        <div class="card-body"> <h2>Enquiry FollowUp </h2></div>
                        <br />
                        <div class="col-md-4 text-right" style="top:1vw;left:-2vw;">
                            <input type="checkbox" id="type" name="StudentType" checked data-bootstrap-switch data-off-color="primary" data-on-color="blue" data-on-text="Course" data-off-text="Placement">
                        </div>
                    </div>
                    <div class="row">

                        <div class="col-md-1" style="padding-right:0px !important;left:1vw;">
                            <label> From Date </label>
                        </div>
                        <div class="col-md-2">
                            <input type="date" class="form-control" id="startDate" name="startDate">
                        </div>
                        <div class="col-md-1" style="padding-right:0px !important">
                            <label>  To Date</label>
                        </div>
                        <div class="col-md-2">
                            <input type="date" class="form-control" id="endDate" name="endDate">
                        </div>
                        <div class="input-group col-md-4" id="EuploaddocumentField">
                            <label model.Status style="width:4vw;"> Type</label>

                            <select id="EnquiryStatusId" name="EnqStatusId" class="form-control col-md-6">
                                <option value=""> -- select -- </option>
                                <option value="63"> Lead</option>
                                <option value="65"> Enquiry</option>

                                <option value="37"> Hold</option>
                                <option value="78"> Enquiry Form Pending</option>
                                <option value="77"> Prospective</option>
                                <option value="6"> Pending</option>
                            </select>
                        </div>
                        <div class="input-group col-md-4" style="left:60vw;top:-37px;" id="EuploaddocumentField">
                            <div class="row">
                                <label model.Status style="margin:6PX;"> FollowUp Status</label>

                                <select id="FollowStatusId" name="FollowUpStatusId" class="form-control col-md-6" style="width:17vw;">
                                    <option value=""> -- select -- </option>
                                    <option value="1">Hot</option>
                                    <option value="2"> Cold</option>
                                    <option value="3"> Worm</option>
                                </select>
                            </div>
                        </div>


                    </div>


                    <div class="card-body" style="padding-top:0px">
                        <div class="container">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card card-primary card-outline card-outline-tabs">
                                        <div class="card-header p-0 border-bottom-0">
                                            <ul class="nav nav-tabs" id="custom-tabs-four-tab" role="tablist">
                                                <li class="nav-item">
                                                    <a class="nav-link active" id="AllStudentab" data-toggle="tab" href="#AllStudentab">All FollowUps</a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link" id="MissedTab" data-toggle="tab" href="#MissedTab">Missed FollowUps</a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link" id="UpcomingFollowUpTab" data-toggle="tab" href="#PendingTab">Upcoming FollowUps</a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link" id="TodayFollowUpTab" data-toggle="tab" href="#PendingTab">Today's FollowUps</a>
                                                </li>


                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div id="LoadLists"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>






<script src="~/Content/plugins/datatables/jquery.dataTables.min.js" type="text/javascript"></script>
<script src="~/Content/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js" type="text/javascript"></script>
<script src="~/Content/plugins/datatables-responsive/js/dataTables.responsive.min.js" type="text/javascript"></script>
<script src="~/Content/plugins/datatables-responsive/js/responsive.bootstrap4.min.js" type="text/javascript"></script>
<script src="~/Content/plugins/datatables-buttons/js/dataTables.buttons.min.js" type="text/javascript"></script>
<script src="~/Content/plugins/datatables-buttons/js/buttons.bootstrap4.min.js" type="text/javascript"></script>
<script src="~/Content/plugins/jszip/jszip.min.js" type="text/javascript"></script>
<script src="~/Content/plugins/pdfmake/pdfmake.min.js" type="text/javascript"></script>
<script src="~/Content/plugins/pdfmake/vfs_fonts.js" type="text/javascript"></script>
<script src="~/Content/plugins/datatables-buttons/js/buttons.html5.min.js" type="text/javascript"></script>
<script src="~/Content/plugins/datatables-buttons/js/buttons.print.min.js" type="text/javascript"></script>
<script src="~/Content/plugins/datatables-buttons/js/buttons.colVis.min.js" type="text/javascript"></script>
<script>
    jQuery(document).ready(function ($) {
        $('input[name="StudentType"]').bootstrapSwitch();
		
		$('#EuploaddocumentField1').hide();
 $('#EuploaddocumentField2').hide();

        var Course;
        var activeTabId;
        var enquiryStatusId;
        var followStatusId;
        loadTabContent('@Url.Action("ListEnquiryFollowupAsyncVU", "Counsellor")');
                loadTabContent('@Url.Action("MissedListStudentVU", "Counsellor")');

        // Initialize date pickers with default values
        var defaultStartDate = new Date();
        defaultStartDate.setFullYear(defaultStartDate.getFullYear() -2);
        var defaultEndDate = new Date();
        defaultEndDate.setMonth(defaultEndDate.getMonth() + 1); // Add one month to the end date

        $('#startDate').val(defaultStartDate.toISOString().slice(0, 10));
        $('#endDate').val(defaultEndDate.toISOString().slice(0, 10));

        // Set the max attribute for the start date input
        var maxDate = new Date();
        maxDate.setDate(maxDate.getDate() + 1); // Tomorrow's date
        $('#startDate').attr('max', maxDate.toISOString().slice(0, 10));

        $('input[name="StudentType"]').on('switchChange.bootstrapSwitch', function (event, state) {
            if (state) {
                // Internal state
                loadTabContent('@Url.Action("ListEnquiryFollowupAsyncVU", "Counsellor")');
                    loadTabContent('@Url.Action("MissedListStudentVU", "Counsellor")');
                //$("#MissedTab").removeClass("active");
                //$("#UpcomingFollowUpTab").removeClass("active");
                //$("#AllStudentab").addClass("active");
               // Show the course dropdown
            } else {
                // External state
                loadTabContent('@Url.Action("ListEnquiryFollowupAsyncVU", "Counsellor")');
                    loadTabContent('@Url.Action("MissedListStudentVU", "Counsellor")');
                //$("#MissedTab").removeClass("active");
                //$("#UpcomingFollowUpTab").removeClass("active");
                //$("#AllStudentab").addClass("active");
            }
        });

        $("#MissedTab").click(function () {


            setTimeout(handleInputChange, 100);

        });
        $("#EnquiryStatusId").change(function () {



            setTimeout(handleInputChange, 100);

        });
        $("#FollowStatusId").change(function () {


            setTimeout(handleInputChange, 100);

        });

        $("#UpcomingFollowUpTab").click(function () {

            setTimeout(handleInputChange, 100);

        });

        $("#TodayFollowUpTab").click(function () {

            setTimeout(handleInputChange, 100);

        });

        $("#AllStudentab").click(function () {
            loadTabContent('@Url.Action("ListEnquiryFollowupAsyncVU", "Counsellor")');
            setTimeout(handleInputChange, 100);

        });

        function loadTabContent(tabContentUrl) {
			
            var startDate = $('#startDate').val();
            var endDate = $('#endDate').val();

            $.ajax({
                url: tabContentUrl,
                type: 'GET',
                data: {
                    startDate: startDate,
                    endDate: endDate,
                    filterType: Course,
                    TabType: activeTabId,
                    EnqStatusId : enquiryStatusId,
                    FollowUpStatusId: followStatusId
                },
                success: function (data) {
                    $('#LoadLists').html(data);
                    var table = $('#LoadLists table').DataTable({
                        "responsive": true,
                        "lengthChange": true,
                        "autoWidth": false,
                        "stateSave": true,
                        "dom": 'Bfrtip',
                        "lengthMenu": [[10, 25, 50, 100]], 
                            "pageLength": 20
                            ,
                        "buttons": [
                            {
                                extend: 'copy',
                                text: '<img src="/Content/Admin/icon/copy.png" title="Copy" alt="Copy" height="20" width="20" />',
                                titleAttr: 'Copy',
								exportOptions: { columns: ':not(:last-child):not(:nth-last-child(2))'  } 
                            },
                            {
                                extend: 'csv',
                                text: '<img src="/Content/Admin/icon/csv.jpg" title="CSV" alt="CSV" height="25" width="25" />',
                                titleAttr: 'CSV',
								exportOptions: { columns: ':not(:last-child):not(:nth-last-child(2))'  } 
                            },
                            {
                                extend: 'excel',
                                text: '<img src="/Content/Admin/icon/xls-file.png" title="xls" alt="xls" height="20" width="20" />',
                                titleAttr: 'Excel',
								exportOptions: { columns: ':not(:last-child):not(:nth-last-child(2))'  } 
                            },
                            {
                                extend: 'pdf',
                                text: '<img src="/Content/Admin/icon/pdf-file.png" title="pdf" alt="pdf" height="20" width="20" />',
                                titleAttr: 'PDF',
								exportOptions: { columns: ':not(:last-child):not(:nth-last-child(2))'  } 
                            },
                            {
                                extend: 'print',
                                text: '<img src="/Content/Admin/icon/printer.png" title="printer" alt="printer" height="20" width="20" />',
                                titleAttr: 'Print'
                            },
                            {
                                extend: 'colvis',
                                text: '<img src="/Content/Admin/icon/column.jpg" title="column" alt="column" height="20" width="20" />',
                                titleAttr: 'Columns',
								exportOptions: { columns: ':not(:last-child):not(:nth-last-child(2))'  } 
                            }
                        ]
                    });
                    table.buttons().container().appendTo('#LoadLists .col-md-6:eq(0)');
                }
				
            });
        }

        function handleInputChange() {

            var tabContentUrl = ''; // Define the URL based on the active tab and switch state
            activeTabId = $('.nav-tabs .nav-item .active').attr('id');

            var isOn = $('input[name="StudentType"]').bootstrapSwitch('state');
            enquiryStatusId = $("#EnquiryStatusId").val();
            followStatusId = $("#FollowStatusId").val();
            if (followStatusId == "") {
                followStatusId = 0
            }
            // Get the corresponding text based on the state
             Course = isOn
                ? $('input[name="StudentType"]').data('on-text')
                : $('input[name="StudentType"]').data('off-text');
            // Check the active tab and switch state to determine the URL and status ID
             switch (activeTabId) {
        case 'MissedTab':
            tabContentUrl = $('input[name="StudentType"]').bootstrapSwitch('state') ? '@Url.Action("MissedListStudentVU", "Counsellor", new { id = "filterType", Tab = "TabType" })'.replace("filterType", Course).replace("TabType", activeTabId) : '@Url.Action("MissedListStudentVU", "Counsellor", new { id = "filterType", Tab = "TabType" })'.replace("filterType", Course).replace("TabType", activeTabId);
            $('#EuploaddocumentField1').show();
            $('#EuploaddocumentField2').show();
            break;
        case 'UpcomingFollowUpTab':
            tabContentUrl = $('input[name="StudentType"]').bootstrapSwitch('state') ? '@Url.Action("MissedListStudentVU", "Counsellor", new { id = "filterType", Tab = "TabType" })'.replace("filterType", Course).replace("TabType", activeTabId) : '@Url.Action("MissedListStudentVU", "Counsellor", new { id = "filterType", Tab = "TabType" })'.replace("filterType", Course).replace("TabType", activeTabId);
            $('#EuploaddocumentField1').show();
            $('#EuploaddocumentField2').show();
            break;
        case 'AllStudentab':
            tabContentUrl = '@Url.Action("ListEnquiryFollowupAsyncVU", "Counsellor")';
            $('#EuploaddocumentField1').hide();
            $('#EuploaddocumentField2').hide();
            break;
        case 'TodayFollowUpTab':
            tabContentUrl = $('input[name="StudentType"]').bootstrapSwitch('state') ? '@Url.Action("MissedListStudentVU", "Counsellor", new { id = "filterType", Tab = "TabType" })'.replace("filterType", Course).replace("TabType", activeTabId) : '@Url.Action("MissedListStudentVU", "Counsellor", new { id = "filterType", Tab = "TabType" })'.replace("filterType", Course).replace("TabType", activeTabId);
            $('#EuploaddocumentField1').show();
            $('#EuploaddocumentField2').show();
            break;
        default:
            break;
    }
            // Load the tab content with the determined URL and status ID
            loadTabContent(tabContentUrl);
        }


         //Event listener for course or date input change
        $('#startDate, #endDate').on('change', function () {
            // Ensure start date is not greater than tomorrow's date
            var startDate = new Date($('#startDate').val());
            var endDate = new Date($('#endDate').val());

            if (startDate > maxDate) {
                toastr.error('Start date cannot be greater than tomorrow.');
                $('#startDate').val(maxDate.toISOString().slice(0, 10));
            } else if (startDate > endDate) {
                toastr.error('Start date cannot be greater than end date.');
                $('#startDate').val(endDate.toISOString().slice(0, 10));
            } else {
                handleInputChange();
            }
            if (startDate > today) {
                toastr.error('Start date cannot be greater than today.');
                $('#startDate').val(today.toISOString().slice(0, 10));
            } else if (startDate > endDate) {
                toastr.error('Start date cannot be greater than end date.');
                $('#startDate').val(endDate.toISOString().slice(0, 10));
            } else {
                handleInputChange();
            }
        });

    });
</script>